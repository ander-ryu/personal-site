<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>ä¸Šä¼  Excel æ›´æ–°ç½‘ç«™</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        // === âœ… ç®€æ˜“åå°å¯†ç éªŒè¯ ===
        document.addEventListener("DOMContentLoaded", () => {
            const saved = localStorage.getItem("admin");
            const correctPassword = "9527"; // ğŸ”’ åœ¨è¿™é‡Œè®¾ç½®ä½ çš„ç½‘ç«™åå°å¯†ç 

            if (saved === "true") return; // å·²ç™»å½•è¿‡ï¼Œä¸å†éªŒè¯

            const input = prompt("è¯·è¾“å…¥åå°ç®¡ç†å¯†ç ï¼š");
            if (input !== correctPassword) {
                alert("âŒ å¯†ç é”™è¯¯ï¼Œæ— æ³•è®¿é—®åå°ï¼");
                window.location.href = "/"; // è¿”å›é¦–é¡µ
            } else {
                localStorage.setItem("admin_authenticated", "true"); // è®°å½•ä¸€æ¬¡ç™»å½•
                alert("âœ… æ¬¢è¿å›æ¥ï¼Œç®¡ç†å‘˜ï¼");
            }
        });
    </script>
</head>

<body>
    <nav>
        <a href="index.html">ç½‘ç«™é¦–é¡µ</a>
        <a href="resume.html">ä¸ªäººå±¥å†</a>
        <a href="projects.html">è¿‡å»é¡¹ç›®</a>
        <a href="hobby.html">æœªæ¥å…´è¶£</a>
        <a href="contact.html">è”ç³»æ–¹å¼</a>
        <a href="display.html">æ•°æ®å±•ç¤º</a>
        <a href="upload.html"><b>åå°ç®¡ç†</b></a>
    </nav>

    <h1>ğŸ“¤ ä¸Šä¼  Excel æ›´æ–°ç½‘ç«™</h1>

    <p>è¯·é€‰æ‹©å¯¼å…¥æ¨¡å¼ï¼š</p>
    <select id="mode">
        <option value="append">è¿½åŠ æ•°æ®ï¼ˆä¿ç•™åŸæœ‰å†…å®¹ï¼‰</option>
        <option value="replace">è¦†ç›–æ•°æ®ï¼ˆå…ˆåˆ é™¤æ‰€æœ‰å†å¯¼å…¥ï¼‰</option>
    </select>

    <br><br>
    <input type="file" id="fileInput" accept=".xlsx" />
    <br><br>
    <button id="uploadBtn">å¼€å§‹ä¸Šä¼  ğŸš€</button>

    <p id="status">ç­‰å¾…ä¸Šä¼ ...</p>

    <script>
        const fileInput = document.getElementById('fileInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const status = document.getElementById('status');

        uploadBtn.addEventListener('click', async () => {
            const file = fileInput.files[0];
            if (!file) {
                status.textContent = "âš ï¸ è¯·å…ˆé€‰æ‹©ä¸€ä¸ª Excel æ–‡ä»¶";
                return;
            }

            status.textContent = "â³ æ­£åœ¨è¯»å–æ–‡ä»¶...";
            const mode = document.getElementById('mode').value;

            try {
                const data = await file.arrayBuffer();
                const workbook = XLSX.read(data, { type: "array" });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const rows = XLSX.utils.sheet_to_json(sheet);

                if (rows.length === 0) {
                    status.textContent = "âŒ Excel æ–‡ä»¶ä¸ºç©º";
                    return;
                }

                status.textContent = "ğŸ“¡ æ­£åœ¨ä¸Šä¼ åˆ°æœåŠ¡å™¨...";
                const res = await fetch("/api/upload", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ mode, rows })
                });

                const result = await res.json();
                if (result.ok) {
                    status.innerHTML = `âœ… ä¸Šä¼ æˆåŠŸï¼ ${result.message}ï¼ˆå…± ${result.count} æ¡è®°å½•ï¼‰`;
                } else {
                    status.textContent = `âŒ ä¸Šä¼ å¤±è´¥ï¼š${result.error || "æœªçŸ¥é”™è¯¯"}`;
                }

            } catch (err) {
                console.error(err);
                status.textContent = "âŒ ä¸Šä¼ å‡ºé”™ï¼š" + err.message;
            }
        });
    </script>
</body>

</html>